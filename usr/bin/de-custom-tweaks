#!/bin/bash

# File path for the community user's AccountsService configuration
communityFile="/var/lib/AccountsService/users/community"
# The desired session type to be set
desiredSession="livecdWayland"

# Function to modify GNOME session for the community user
modify_gnome_session() {
    # Check if we are in LiveCD mode
    if [ -e /usr/bin/startbiglive ]; then
        # Check if the community file exists
        if [ -f "$communityFile" ]; then
            # Modify XSession only if the file exists
            sed -i "s/XSession=.*/XSession=$desiredSession/" "$communityFile"
            echo "Modified XSession for community user to $desiredSession"
            # Display the content of the file for verification
            cat "$communityFile"
        else
            echo "Community user file not found: $communityFile"
        fi
    else
        echo "Not in LiveCD mode, skipping modification"
    fi
}

# Function for KDE-specific tweaks
kde_tweaks() {
    echo "Applying KDE tweaks"
    # Add KDE-specific tweaks here
}

# Function for XFCE-specific tweaks
xfce_tweaks() {
    echo "Applying XFCE tweaks"
    # Add XFCE-specific tweaks here
}

# Function to detect the current desktop environment and apply appropriate tweaks
detect_and_apply_tweaks() {
    case "$XDG_CURRENT_DESKTOP" in
        GNOME)
            modify_gnome_session
            ;;
        KDE)
            kde_tweaks
            ;;
        XFCE)
            xfce_tweaks
            ;;
        *)
            # If the desktop environment is not recognized, default to GNOME tweaks
            echo "Desktop environment not recognized, applying GNOME tweaks by default"
            modify_gnome_session
            ;;
    esac
}

# Execute the main function
detect_and_apply_tweaks

exit 0
